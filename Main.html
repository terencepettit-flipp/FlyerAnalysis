<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Flyer Run Report</title>
    <style>
      :root {
        --bg: #0b0f14;
        --panel: #111823;
        --panel2: #0f1620;
        --text: #e8eef7;
        --muted: #9bb0c7;
        --border: #233044;
        --danger: #ff6b6b;
        --ok: #4cd964;
        --accent: #4da3ff;
      }

      * { box-sizing: border-box; }
      body {
        margin: 0;
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        background: radial-gradient(1200px 700px at 30% -10%, #142033, var(--bg));
        color: var(--text);
      }

      .wrap {
        max-width: 1000px;
        margin: 0 auto;
        padding: 18px;
      }

      .topbar {
        position: sticky;
        top: 0;
        z-index: 10;
        padding: 14px;
        border: 1px solid var(--border);
        background: linear-gradient(180deg, rgba(17,24,35,0.92), rgba(17,24,35,0.78));
        backdrop-filter: blur(10px);
        border-radius: 16px;
      }

      .title {
        display: flex;
        align-items: baseline;
        justify-content: space-between;
        gap: 12px;
        margin-bottom: 12px;
      }

      .title h1 {
        font-size: 16px;
        margin: 0;
        letter-spacing: 0.2px;
      }

      .hint {
        color: var(--muted);
        font-size: 12px;
      }

      form {
        display: grid;
        grid-template-columns: 1.2fr 1fr 1fr auto;
        gap: 10px;
        align-items: end;
      }

      label {
        display: grid;
        gap: 6px;
        font-size: 12px;
        color: var(--muted);
      }

      input {
        width: 100%;
        padding: 10px 11px;
        border-radius: 12px;
        border: 1px solid var(--border);
        background: var(--panel2);
        color: var(--text);
        outline: none;
      }
      input:focus {
        border-color: rgba(77,163,255,0.7);
        box-shadow: 0 0 0 3px rgba(77,163,255,0.15);
      }

      button {
        padding: 10px 14px;
        border-radius: 12px;
        border: 1px solid rgba(77,163,255,0.6);
        background: rgba(77,163,255,0.15);
        color: var(--text);
        cursor: pointer;
        font-weight: 600;
      }
      button:hover { background: rgba(77,163,255,0.22); }
      button:disabled {
        opacity: 0.55;
        cursor: not-allowed;
      }

      .status {
        margin-top: 10px;
        padding: 10px 12px;
        border-radius: 12px;
        border: 1px solid var(--border);
        background: rgba(15,22,32,0.65);
        font-size: 13px;
        color: var(--muted);
        display: none;
      }
      .status.show { display: block; }
      .status.error { color: var(--danger); border-color: rgba(255,107,107,0.45); }
      .status.ok { color: var(--ok); border-color: rgba(76,217,100,0.35); }

      .content {
        margin-top: 16px;
        border: 1px dashed rgba(35,48,68,0.9);
        border-radius: 16px;
        padding: 18px;
        min-height: 240px;
        color: var(--muted);
      }

      .kv {
        margin-top: 10px;
        display: grid;
        grid-template-columns: 160px 1fr;
        gap: 6px 12px;
        font-size: 13px;
      }

      .pill {
        display: inline-flex;
        gap: 8px;
        align-items: center;
        padding: 6px 10px;
        border-radius: 999px;
        border: 1px solid var(--border);
        background: rgba(17,24,35,0.6);
        color: var(--muted);
        font-size: 12px;
      }

      .row {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        margin-top: 12px;
        align-items: center;
        justify-content: space-between;
      }

      .small {
        font-size: 12px;
        color: var(--muted);
      }

      code {
        background: rgba(255,255,255,0.06);
        padding: 2px 6px;
        border-radius: 8px;
        border: 1px solid rgba(255,255,255,0.08);
      }

      @media (max-width: 820px) {
        form { grid-template-columns: 1fr; }
      }
    </style>
  </head>

  <body>
    <div class="wrap">
      <div class="topbar">
        <div class="title">
          <h1>Flyer Run Report Generator</h1>
          <div class="hint">Enter parameters → Generate report</div>
        </div>

        <form id="paramsForm">
          <label>
            Flyer Run ID
            <input id="flyerRunId" inputmode="numeric" placeholder="e.g., 1185245" />
          </label>

          <label>
            Start date
            <input id="startDate" type="date" />
          </label>

          <label>
            End date
            <input id="endDate" type="date" />
          </label>

          <button id="generateBtn" type="submit">Generate report</button>
        </form>

        <div id="status" class="status"></div>

        <div class="row">
          <div class="pill"><span>Mode:</span> <strong>stub</strong></div>
          <div class="small">
            API hooks live in <code>generateReport(params)</code>
          </div>
        </div>
      </div>

      <div id="report" class="content">
        Report area (empty until you generate).
      </div>
    </div>

    <script>
      // ---------- Utilities ----------
      function $(id) { return document.getElementById(id); }

      function setStatus(message, kind /* "ok" | "error" | "" */) {
        const el = $("status");
        if (!message) {
          el.textContent = "";
          el.className = "status";
          return;
        }
        el.textContent = message;
        el.className = `status show ${kind || ""}`.trim();
      }

      function parseFlyerRunId(value) {
        const trimmed = String(value || "").trim();
        if (!trimmed) return null;
        // Only allow digits, but tolerate whitespace.
        if (!/^\d+$/.test(trimmed)) return NaN;
        const n = Number(trimmed);
        return Number.isSafeInteger(n) && n > 0 ? n : NaN;
      }

      function parseDate(value) {
        // value from <input type="date"> is "YYYY-MM-DD" or "".
        if (!value) return null;
        // Force UTC midnight to avoid timezone surprises when displaying.
        const d = new Date(value + "T00:00:00Z");
        return Number.isNaN(d.getTime()) ? NaN : d;
      }

      function formatISODate(d) {
        // d assumed valid Date
        const yyyy = d.getUTCFullYear();
        const mm = String(d.getUTCMonth() + 1).padStart(2, "0");
        const dd = String(d.getUTCDate()).padStart(2, "0");
        return `${yyyy}-${mm}-${dd}`;
      }

      function escapeHtml(s) {
        return String(s)
          .replaceAll("&", "&amp;")
          .replaceAll("<", "&lt;")
          .replaceAll(">", "&gt;")
          .replaceAll('"', "&quot;")
          .replaceAll("'", "&#39;");
      }

      // ---------- Core ----------
      async function generateReport(params) {
        // This is where you'll call APIs and assemble the report.
        // For now, we just echo the parameters into the report area.

        const reportEl = $("report");
        reportEl.innerHTML = `
          <div style="color: var(--text); font-weight: 700; margin-bottom: 8px;">
            Parameters received
          </div>
          <div class="kv">
            <div>Flyer Run ID</div><div><code>${escapeHtml(params.flyerRunId)}</code></div>
            <div>Start date</div><div><code>${escapeHtml(params.startDate)}</code></div>
            <div>End date</div><div><code>${escapeHtml(params.endDate)}</code></div>
          </div>

          <div style="margin-top: 14px; color: var(--muted);">
            Next: replace <code>generateReport(params)</code> with your API calls and rendering logic.
          </div>
        `;

        // Example structure for later:
        // const dataA = await fetchJson(`/api/a?flyerRunId=${params.flyerRunId}...`);
        // const dataB = await fetchJson(`/api/b?...`);
        // reportEl.innerHTML = renderReport({ dataA, dataB, params });
      }

      $("paramsForm").addEventListener("submit", async (e) => {
        e.preventDefault();

        setStatus("", "");
        const btn = $("generateBtn");
        btn.disabled = true;
        btn.textContent = "Generating…";

        try {
          const flyerRunIdParsed = parseFlyerRunId($("flyerRunId").value);
          const startDateParsed = parseDate($("startDate").value);
          const endDateParsed = parseDate($("endDate").value);

          // Validation
          if (flyerRunIdParsed === null || Number.isNaN(flyerRunIdParsed)) {
            setStatus("Flyer Run ID must be a positive integer.", "error");
            return;
          }
          if (startDateParsed === null || Number.isNaN(startDateParsed)) {
            setStatus("Start date is required.", "error");
            return;
          }
          if (endDateParsed === null || Number.isNaN(endDateParsed)) {
            setStatus("End date is required.", "error");
            return;
          }
          if (endDateParsed.getTime() < startDateParsed.getTime()) {
            setStatus("End date must be on or after start date.", "error");
            return;
          }

          const params = {
            flyerRunId: String(flyerRunIdParsed),
            startDate: formatISODate(startDateParsed),
            endDate: formatISODate(endDateParsed),
          };

          setStatus("Inputs validated. Building report…", "");
          await generateReport(params);
          setStatus("Report generated.", "ok");
        } catch (err) {
          console.error(err);
          setStatus("Something went wrong while generating the report. See console for details.", "error");
        } finally {
          btn.disabled = false;
          btn.textContent = "Generate report";
        }
      });
    </script>
  </body>
</html>
